<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Planificador de Gastos</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-bg: #f8fafc;
      --card-bg: #ffffff;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --border-color: #e2e8f0;
      --header-bg: #0f172a;
      --header-text: #ffffff;
      --income-color: #10b981;
      --expense-color: #ef4444;
      --available-color: #06b6d4;
      --warning-color: #f59e0b;
      --btn-primary: #10b981;
      --btn-danger: #ef4444;
      --btn-secondary: #4f46e5;
      --btn-print: #06b6d4;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --primary-bg: #0f172a;
        --card-bg: #1e293b;
        --text-primary: #f8fafc;
        --text-secondary: #cbd5e1;
        --border-color: #334155;
        --header-bg: #0c1427;
        --header-text: #f8fafc;
      }
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', system-ui, sans-serif;
    }

    body {
      background-color: var(--primary-bg);
      color: var(--text-primary);
      padding: 16px;
      line-height: 1.6;
    }

    header {
      background: var(--header-bg);
      color: var(--header-text);
      text-align: center;
      margin-bottom: 24px;
      padding: 20px 16px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.1);
    }

    h1 {
      font-size: 1.9rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 22px;
      margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.04);
      border: 1px solid var(--border-color);
    }

    h2 {
      margin-bottom: 18px;
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 18px;
    }

    @media (max-width: 600px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text-secondary);
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      font-size: 1rem;
      background: var(--card-bg);
      color: var(--text-primary);
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--income-color);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
    }

    button {
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
      border-radius: 10px;
      background: linear-gradient(to bottom, var(--btn-primary), #0d9368);
      color: white;
      padding: 12px;
    }

    button:hover {
      opacity: 0.92;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
    }

    .btn-danger {
      background: linear-gradient(to bottom, var(--btn-danger), #dc2626);
    }
    .btn-secondary {
      background: linear-gradient(to bottom, var(--btn-secondary), #4338ca);
    }
    .btn-print {
      background: linear-gradient(to bottom, var(--btn-print), #0891b2);
    }

    .entry {
      background: rgba(241, 245, 249, 0.4);
      padding: 18px;
      border-radius: 12px;
      margin-bottom: 18px;
      border-left: 4px solid var(--expense-color);
    }

    .entry.income {
      border-left-color: var(--income-color);
    }

    .hidden { display: none; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 18px;
    }

    th, td {
      padding: 14px 10px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
      font-size: 0.95rem;
    }

    th {
      background: rgba(15, 23, 42, 0.03);
      font-weight: 600;
      color: var(--text-secondary);
    }

    /* NUEVO: Estilos para la tabla de resultados y tarjetas */
    .results-container {
      background: #1e293b;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }

    .results-header {
      color: #f8fafc;
      font-size: 1.3rem;
      margin-bottom: 16px;
    }

    .results-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }

    .results-table th,
    .results-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #334155;
      color: #f8fafc;
      font-size: 0.95rem;
    }

    .results-table th {
      background: #1e293b;
      font-weight: 600;
      color: #cbd5e1;
    }

    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }

    .summary-card {
      background: #1e293b;
      border-radius: 10px;
      padding: 16px;
      text-align: center;
      border-top: 4px solid transparent;
      color: #f8fafc;
    }

    .summary-card.income { border-top: 4px solid #10b981; }
    .summary-card.expense { border-top: 4px solid #ef4444; }
    .summary-card.savings { border-top: 4px solid #06b6d4; }
    .summary-card.available { border-top: 4px solid #06b6d4; }

    .summary-card-title {
      font-size: 0.9rem;
      margin-bottom: 8px;
      opacity: 0.8;
    }

    .summary-card-value {
      font-size: 1.4rem;
      font-weight: 700;
    }

    .explanation {
      font-size: 0.85rem;
      color: #94a3b8;
      margin-top: 6px;
      font-style: italic;
    }

    .alert {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning-color);
      padding: 14px;
      border-radius: 12px;
      margin: 16px 0;
      display: none;
      border-left: 4px solid var(--warning-color);
    }

    @media print {
      .no-print { display: none !important; }
      body { background: white; color: black; padding: 0; }
      .card { box-shadow: none; border: 1px solid #ccc; }
    }

    details summary {
      list-style: none;
    }
    details summary::-webkit-details-marker { display: none; }
    details summary::after { content: "‚ñº"; float: right; font-size: 0.8rem; color: var(--text-secondary); }
    details[open] summary::after { content: "‚ñ≤"; }
  </style>
</head>
<body>

  <header>
    <h1 id="page-title">Planificador de Gastos</h1>
    <p>Controla tu dinero con claridad y confianza</p>
  </header>

  <section class="card no-print">
    <details>
      <summary>üé® Personalizar</summary>
      <div class="form-row">
        <div>
          <label for="theme-color">Color principal:</label>
          <input type="color" id="theme-color" value="#10b981">
        </div>
        <div>
          <label for="page-title-input">T√≠tulo del plan:</label>
          <input type="text" id="page-title-input" value="Planificador de Gastos">
        </div>
      </div>
    </details>
  </section>

  <section class="card">
    <h2>1. Ingresos</h2>
    <div id="incomes"></div>
    <button id="add-income" class="no-print">+ Agregar ingreso</button>
  </section>

  <section class="card">
    <h2>2. Gastos y Deudas</h2>
    <div id="expenses"></div>
    <button id="add-expense" class="no-print">+ Agregar gasto</button>
  </section>

  <section class="card">
    <h2>3. Ahorro</h2>
    <div class="form-row">
      <div>
        <label>Nombre de la meta:</label>
        <input type="text" id="savings-name" placeholder="Ej. Fondo de emergencia">
      </div>
      <div>
        <label>Monto total a ahorrar ($):</label>
        <input type="number" id="savings-total" min="0" step="10" placeholder="0">
      </div>
    </div>
    <div class="form-row">
      <div>
        <label>Fecha l√≠mite para completar el ahorro:</label>
        <input type="date" id="savings-deadline">
      </div>
      <div>
        <label>Ahorro por per√≠odo:</label>
        <input type="text" id="savings-per-period" readonly>
      </div>
    </div>
    <p id="savings-hint" class="explanation" style="margin-top:10px;"></p>
  </section>

  <div class="alert no-print" id="warning"></div>

  <section class="card no-print">
    <button id="save">üíæ Guardar plan</button>
    <button id="reset" class="btn-danger">üóëÔ∏è Restablecer todo</button>
    <button id="print" class="btn-print">üñ®Ô∏è Imprimir</button>
    <button id="pdf" class="btn-secondary">üìÑ Guardar como PDF</button>
    <p style="font-size:0.85rem; margin-top:12px; color:var(--text-secondary);">
      Los botones de PDF e Imprimir generan un documento limpio. Funcionan sin internet.
    </p>
  </section>

  <section class="card">
    <h2>Resultados</h2>
    <div id="summary"></div>
    <div class="results-container">
      <div class="results-header">Resumen financiero</div>
      <table class="results-table">
        <thead>
          <tr>
            <th>Gasto / Meta</th>
            <th>Original</th>
            <th>Apartar por per√≠odo</th>
            <th>Explicaci√≥n</th>
          </tr>
        </thead>
        <tbody id="results-table"></tbody>
      </table>
      <div class="summary-cards" id="summary-cards"></div>
    </div>
  </section>

  <script>
    const round2 = (n) => Math.round(n * 100) / 100;
    const safeNum = (v) => {
      const n = parseFloat(v);
      return isNaN(n) || n < 0 ? 0 : n;
    };

    const PERIOD_WEEKS = { weekly: 1, biweekly: 2, monthly: 4 };
    const EXPENSE_TO_WEEKS = { 
      weekly: 1, biweekly: 2, monthly: 4, bimonthly: 8, quarterly: 12, annual: 52 
    };
    const PERIOD_LABELS = { weekly: 'semana', biweekly: 'quincena', monthly: 'mes' };
    const FULL_LABELS = {
      weekly: 'semanal', biweekly: 'quincenal', monthly: 'mensual',
      bimonthly: 'bimestral', quarterly: 'trimestral', annual: 'anual'
    };

    function getPeriodsBetween(startDate, endDate, periodType) {
      if (endDate <= startDate) return 1;
      const totalWeeks = Math.ceil((endDate - startDate) / (7 * 24 * 60 * 60 * 1000));
      const weeksPerPeriod = PERIOD_WEEKS[periodType] || 4;
      return Math.max(1, Math.ceil(totalWeeks / weeksPerPeriod));
    }

    function updateSavingsByPeriod() {
      const total = safeNum(document.getElementById('savings-total').value);
      const deadlineStr = document.getElementById('savings-deadline').value;
      const firstIncome = document.querySelector('#incomes .entry');

      if (!firstIncome) {
        document.getElementById('savings-per-period').value = '';
        document.getElementById('savings-hint').textContent = 'Agrega un ingreso primero.';
        return;
      }

      const periodType = firstIncome.querySelector('.period').value || 'monthly';
      let periods = 12;
      let hint = '';

      if (deadlineStr) {
        const today = new Date();
        today.setHours(0,0,0,0);
        const deadline = new Date(deadlineStr);
        deadline.setHours(0,0,0,0);

        if (deadline < today) {
          periods = 1;
          hint = `‚ö†Ô∏è Fecha pasada. Ahorra todo esta ${PERIOD_LABELS[periodType]}.`;
        } else {
          periods = getPeriodsBetween(today, deadline, periodType);
          const formatter = new Intl.DateTimeFormat('es-ES', { dateStyle: 'medium' });
          hint = `üìÖ ${periods} ${PERIOD_LABELS[periodType]}${periods !== 1 ? 's' : ''} hasta ${formatter.format(deadline)}`;
        }
      } else {
        hint = `Elige fecha l√≠mite para calcular ahorro por ${PERIOD_LABELS[periodType]}.`;
      }

      const amountPerPeriod = total > 0 ? round2(total / periods) : 0;
      document.getElementById('savings-per-period').value = amountPerPeriod;
      document.getElementById('savings-hint').textContent = hint;
    }

    function addIncome(data = {}) {
      const period = data.period || 'monthly';
      const div = document.createElement('div');
      div.className = 'entry income';
      div.innerHTML = `
        <div class="form-row">
          <input type="text" class="name" placeholder="Nombre" value="${data.name || ''}">
          <input type="number" class="amount" placeholder="0" value="${data.amount || ''}" min="0" step="0.01">
        </div>
        <label>Frecuencia:</label>
        <select class="period">
          <option value="weekly" ${period === 'weekly' ? 'selected' : ''}>Semanal</option>
          <option value="biweekly" ${period === 'biweekly' ? 'selected' : ''}>Quincenal</option>
          <option value="monthly" ${period === 'monthly' ? 'selected' : ''}>Mensual</option>
        </select>
        <button type="button" class="del btn-danger no-print" style="padding:8px; margin-top:12px;">Eliminar</button>
      `;
      document.getElementById('incomes').appendChild(div);
      updateSavingsByPeriod();
    }

    function addExpense(data = {}) {
      const type = data.type || 'recur';
      const div = document.createElement('div');
      div.className = 'entry';
      const today = new Date().toISOString().split('T')[0];
      const defaultDate = data.date || today;

      div.innerHTML = `
        <div class="form-row">
          <input type="text" class="name" placeholder="Nombre" value="${data.name || ''}">
          <input type="number" class="amount" placeholder="0" value="${data.amount || ''}" min="0" step="0.01">
        </div>
        <label>Tipo de gasto:</label>
        <select class="type">
          <option value="recur" ${type === 'recur' ? 'selected' : ''}>Recurrente (frecuencia)</option>
          <option value="once" ${type === 'once' ? 'selected' : ''}>√önico (fecha exacta)</option>
        </select>
        <div class="recur-section ${type === 'recur' ? '' : 'hidden'}">
          <label>Frecuencia:</label>
          <select class="period">
            <option value="weekly" ${data.period === 'weekly' ? 'selected' : ''}>Semanal</option>
            <option value="biweekly" ${data.period === 'biweekly' ? 'selected' : ''}>Quincenal</option>
            <option value="monthly" ${data.period === 'monthly' ? 'selected' : ''}>Mensual</option>
            <option value="bimonthly" ${data.period === 'bimonthly' ? 'selected' : ''}>Bimestral</option>
            <option value="quarterly" ${data.period === 'quarterly' ? 'selected' : ''}>Trimestral</option>
            <option value="annual" ${data.period === 'annual' ? 'selected' : ''}>Anual</option>
          </select>
        </div>
        <div class="once-section ${type === 'once' ? '' : 'hidden'}">
          <label>Fecha del gasto:</label>
          <input type="date" class="date" value="${defaultDate}">
        </div>
        <button type="button" class="del btn-danger no-print" style="padding:8px; margin-top:12px;">Eliminar</button>
      `;
      document.getElementById('expenses').appendChild(div);

      div.querySelector('.type').onchange = (e) => {
        const t = e.target.value;
        div.querySelector('.recur-section').classList.toggle('hidden', t !== 'recur');
        div.querySelector('.once-section').classList.toggle('hidden', t !== 'once');
      };
    }

    function init() {
      const today = new Date();
      const defaultDate = new Date(today);
      defaultDate.setMonth(today.getMonth() + 12);
      document.getElementById('savings-deadline').valueAsDate = defaultDate;
      loadFromStorage();
      attachListeners();
      updateSavingsByPeriod();
      updateAll();
    }

    function attachListeners() {
      document.getElementById('add-income').onclick = () => addIncome();
      document.getElementById('add-expense').onclick = () => addExpense();
      document.getElementById('reset').onclick = resetAll;
      document.getElementById('save').onclick = saveToStorage;
      document.getElementById('print').onclick = () => window.print();
      document.getElementById('pdf').onclick = () => {
        alert("Para guardar como PDF:\n1. Haz clic en 'Imprimir'\n2. En la ventana, elige 'Guardar como PDF'");
        window.print();
      };

      ['savings-total', 'savings-deadline'].forEach(id => {
        document.getElementById(id).addEventListener('input', updateSavingsByPeriod);
      });
      document.getElementById('incomes').addEventListener('input', updateSavingsByPeriod);
      document.getElementById('incomes').addEventListener('change', updateSavingsByPeriod);

      document.getElementById('theme-color').onchange = (e) => {
        document.documentElement.style.setProperty('--btn-primary', e.target.value);
        document.documentElement.style.setProperty('--income-color', e.target.value);
      };
      document.getElementById('page-title-input').oninput = (e) => {
        document.getElementById('page-title').textContent = e.target.value;
      };

      document.body.addEventListener('input', updateAll);
      document.body.addEventListener('click', (e) => {
        if (e.target.classList.contains('del')) {
          e.target.closest('.entry').remove();
          updateAll();
        }
      });
    }

    function updateAll() {
      const incomes = [];
      document.querySelectorAll('#incomes .entry').forEach(el => {
        const name = el.querySelector('.name').value.trim() || 'Ingreso';
        const amount = safeNum(el.querySelector('.amount').value);
        const period = el.querySelector('.period').value || 'monthly';
        if (amount > 0) incomes.push({ name, amount, period });
      });

      if (incomes.length === 0) {
        document.getElementById('results-table').innerHTML = '<tr><td colspan="4">Agrega al menos un ingreso.</td></tr>';
        document.getElementById('summary-cards').innerHTML = '';
        document.getElementById('summary').innerHTML = '';
        document.getElementById('warning').style.display = 'none';
        return;
      }

      const basePeriod = incomes[0].period;
      const baseWeeks = PERIOD_WEEKS[basePeriod] || 4;
      let totalIncome = 0;
      incomes.forEach(i => {
        const iWeeks = PERIOD_WEEKS[i.period] || 4;
        const factor = baseWeeks / iWeeks;
        i.equivalent = round2(i.amount * factor);
        totalIncome += i.equivalent;
      });

      const expenses = [];
      const today = new Date();
      today.setHours(0,0,0,0);

      document.querySelectorAll('#expenses .entry').forEach(el => {
        const name = el.querySelector('.name').value.trim() || 'Gasto';
        const amount = safeNum(el.querySelector('.amount').value);
        if (amount <= 0) return;

        const type = el.querySelector('.type').value;
        let apartado = 0;
        let original = '';
        let explanation = '';

        if (type === 'once') {
          const dateStr = el.querySelector('.date').value || new Date().toISOString().split('T')[0];
          const due = new Date(dateStr);
          due.setHours(0,0,0,0);
          const periods = getPeriodsBetween(today, due, basePeriod);
          apartado = round2(amount / periods);
          original = `$${round2(amount)} (√∫nico, ${dateStr})`;
          explanation = `Apartar $${apartado} por cada ${PERIOD_LABELS[basePeriod]} hasta ${dateStr}`;
        } else {
          const period = el.querySelector('.period').value;
          const expWeeks = EXPENSE_TO_WEEKS[period] || 4;
          const periodsInCycle = expWeeks / baseWeeks;
          apartado = round2(amount / periodsInCycle);
          original = `$${round2(amount)} / ${FULL_LABELS[period]}`;
          explanation = `Apartar $${apartado} por cada ${PERIOD_LABELS[basePeriod]}`;
        }
        expenses.push({ name, amount, type, original, apartado, explanation });
      });

      const savingsAmount = safeNum(document.getElementById('savings-per-period').value);
      const savingsName = document.getElementById('savings-name').value.trim() || 'Ahorro';
      const totalSetAside = expenses.reduce((sum, e) => sum + e.apartado, 0);
      const totalOut = totalSetAside + savingsAmount;
      const available = totalIncome - totalOut;

      const warningEl = document.getElementById('warning');
      let warningText = '';
      if (available < 0) {
        warningText = `‚ö†Ô∏è ¬°Gastos + ahorro superan tus ingresos por ${PERIOD_LABELS[basePeriod]}!`;
      } else if (totalIncome > 0 && (savingsAmount / totalIncome) < 0.1) {
        warningText = `üí° Recomendado: ahorra ‚â•10% por ${PERIOD_LABELS[basePeriod]}.`;
      }
      warningEl.textContent = warningText;
      warningEl.style.display = warningText ? 'block' : 'none';

      renderResults(incomes, expenses, savingsName, savingsAmount, totalIncome, available, basePeriod);
    }

    function renderResults(incomes, expenses, savingsName, savingsAmount, totalIncome, available, basePeriod) {
      const tbody = document.getElementById('results-table');
      tbody.innerHTML = '';

      // Mostrar ingresos como fila en la tabla
      incomes.forEach(i => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i.name} (${FULL_LABELS[i.period]})</td><td>$${round2(i.amount)}</td><td>$${round2(i.equivalent)}</td><td>Ingreso por ${PERIOD_LABELS[basePeriod]}</td>`;
        tbody.appendChild(tr);
      });

      // Mostrar gastos
      expenses.forEach(e => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${e.name}</td><td>${e.original}</td><td>$${e.apartado}</td><td class="explanation">${e.explanation}</td>`;
        tbody.appendChild(tr);
      });

      // Mostrar ahorro
      if (savingsAmount > 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${savingsName}</td><td>$${round2(savingsAmount)} total por ${PERIOD_LABELS[basePeriod]}</td><td>$${round2(savingsAmount)}</td><td>Ahorro por cada ${PERIOD_LABELS[basePeriod]}</td>`;
        tbody.appendChild(tr);
      }

      // ‚úÖ NUEVO: Fila expl√≠cita de DINERO DISPONIBLE
      const availableRow = document.createElement('tr');
      availableRow.style.backgroundColor = available >= 0 ? 'rgba(16, 185, 129, 0.15)' : 'rgba(239, 68, 68, 0.15)';
      availableRow.innerHTML = `
        <td><strong>üí∞ Dinero disponible</strong></td>
        <td>‚Äî</td>
        <td><strong>$${round2(Math.max(0, available))}${available < 0 ? ' (d√©ficit)' : ''}</strong></td>
        <td>${available >= 0 ? '¬°Listo para usar o invertir!' : '‚ö†Ô∏è Necesitas ajustar gastos o ingresos.'}</td>
      `;
      tbody.appendChild(availableRow);

      // Renderizar tarjetas de resumen
      document.getElementById('summary-cards').innerHTML = `
        <div class="summary-card income">
          <div class="summary-card-title">Ingreso</div>
          <div class="summary-card-value">$${round2(totalIncome)}</div>
        </div>
        <div class="summary-card expense">
          <div class="summary-card-title">Gastos</div>
          <div class="summary-card-value">$${round2(totalSetAside)}</div>
        </div>
        <div class="summary-card savings">
          <div class="summary-card-title">Ahorro</div>
          <div class="summary-card-value">$${round2(savingsAmount)}</div>
        </div>
        <div class="summary-card available">
          <div class="summary-card-title">Disponible</div>
          <div class="summary-card-value">$${round2(Math.max(0, available))}</div>
        </div>
      `;
    }

    function saveToStorage() {
      const data = {
        incomes: Array.from(document.querySelectorAll('#incomes .entry')).map(el => ({
          name: el.querySelector('.name').value,
          amount: el.querySelector('.amount').value,
          period: el.querySelector('.period').value
        })),
        expenses: Array.from(document.querySelectorAll('#expenses .entry')).map(el => {
          const type = el.querySelector('.type').value;
          return {
            name: el.querySelector('.name').value,
            amount: el.querySelector('.amount').value,
            type: type,
            period: type === 'recur' ? el.querySelector('.period').value : null,
            date: type === 'once' ? el.querySelector('.date').value : null
          };
        }),
        savingsName: document.getElementById('savings-name').value,
        savingsTotal: document.getElementById('savings-total').value,
        savingsDeadline: document.getElementById('savings-deadline').value,
        themeColor: getComputedStyle(document.documentElement).getPropertyValue('--btn-primary').trim(),
        pageTitle: document.getElementById('page-title').textContent
      };
      localStorage.setItem('financialPlan', JSON.stringify(data));
      alert('‚úÖ Plan guardado localmente.');
    }

    function loadFromStorage() {
      const data = JSON.parse(localStorage.getItem('financialPlan'));
      if (!data) return;

      document.getElementById('incomes').innerHTML = '';
      (data.incomes || []).forEach(i => addIncome(i));

      document.getElementById('expenses').innerHTML = '';
      (data.expenses || []).forEach(e => addExpense(e));

      document.getElementById('savings-name').value = data.savingsName || '';
      document.getElementById('savings-total').value = data.savingsTotal || '';
      document.getElementById('savings-deadline').value = data.savingsDeadline || '';

      if (data.themeColor) {
        document.documentElement.style.setProperty('--btn-primary', data.themeColor);
        document.documentElement.style.setProperty('--income-color', data.themeColor);
        document.getElementById('theme-color').value = data.themeColor;
      }
      if (data.pageTitle) {
        document.getElementById('page-title').textContent = data.pageTitle;
        document.getElementById('page-title-input').value = data.pageTitle;
      }
      updateAll();
    }

    function resetAll() {
      if (confirm('¬øBorrar todo el plan actual?')) {
        localStorage.removeItem('financialPlan');
        document.getElementById('incomes').innerHTML = '';
        document.getElementById('expenses').innerHTML = '';
        document.getElementById('savings-name').value = '';
        document.getElementById('savings-total').value = '';
        const today = new Date();
        const defaultDate = new Date(today);
        defaultDate.setMonth(today.getMonth() + 12);
        document.getElementById('savings-deadline').valueAsDate = defaultDate;
        document.getElementById('theme-color').value = '#10b981';
        document.documentElement.style.setProperty('--btn-primary', '#10b981');
        document.documentElement.style.setProperty('--income-color', '#10b981');
        document.getElementById('page-title').textContent = 'Planificador de Gastos';
        document.getElementById('page-title-input').value = 'Planificador de Gastos';
        updateAll();
      }
    }

    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
